<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Financial planner — local-first</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0e0f13; --panel:#151821; --ink:#ffffff; --muted:#9aa3b2; --accent:#4fb7ff; --accent2:#7cf29a;
      --danger:#ff6b6b; --warn:#f7c948; --border:#22273a; --input:#0b0d12; --focus:#9bd4ff;
      --shadow:0 12px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial}
    header{
      position:sticky; top:0; z-index:10; padding:14px 16px; border-bottom:1px solid var(--border);
      background:linear-gradient(to bottom, rgba(21,24,33,.92), rgba(21,24,33,.75)); backdrop-filter:saturate(140%) blur(8px);
    }
    .title{display:flex; align-items:center; gap:12px}
    .badge{font-size:12px; color:var(--muted); border:1px solid var(--border); padding:4px 8px; border-radius:999px}
    main{max-width:1100px; margin:24px auto; padding:0 16px}
    .grid{display:grid; gap:16px; grid-template-columns:1fr}
    @media (min-width:960px){ .grid{grid-template-columns:1.2fr .8fr} }
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow)}
    .panel>header{background:transparent; position:static; border-bottom:1px solid var(--border); padding:12px 14px}
    .panel>header h2{margin:0; font-size:16px}
    .content{padding:12px 14px}
    .foot{padding:10px 14px; border-top:1px solid var(--border); color:var(--muted); font-size:12px}
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
    button{
      background:var(--accent); color:#03121b; border:none; border-radius:10px; padding:8px 12px; font-weight:600; cursor:pointer
    }
    button.secondary{background:#23283b; color:var(--ink)}
    button.danger{background:var(--danger); color:#1a0f0f}
    button:disabled{opacity:.65; cursor:not-allowed}
    table{width:100%; border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border); padding:10px; vertical-align:middle}
    th{color:var(--muted); font-weight:600; text-transform:uppercase; font-size:12px; letter-spacing:.04em}
    tr:last-child td{border-bottom:none}
    input,select{
      width:100%; background:var(--input); color:var(--ink); border:1px solid var(--border); border-radius:10px; padding:8px 10px;
      outline:none; transition:border .15s, box-shadow .15s
    }
    input:focus{border-color:var(--focus); box-shadow:0 0 0 3px rgba(79,183,255,.25)}
    input[type="date"]::-webkit-calendar-picker-indicator{filter:invert(1)}
    .row-actions{display:flex; gap:8px}
    .summary{display:grid; gap:10px; grid-template-columns:repeat(3,1fr)}
    .card{background:var(--input); border:1px solid var(--border); border-radius:12px; padding:10px 12px}
    .label{color:var(--muted); font-size:12px}
    .value{font-size:18px; font-weight:700}
    .positive{color:var(--accent2)} .negative{color:var(--danger)}
    .chip{display:inline-flex; align-items:center; gap:6px; background:#0c0f14; border:1px solid var(--border); color:var(--muted); padding:6px 10px; border-radius:999px; font-size:12px}
    .status-ok{color:var(--accent2)} .status-due{color:var(--warn)} .status-overdue{color:var(--danger)}
    .kbd{border:1px solid var(--border); background:#0c0e12; padding:2px 6px; border-radius:6px; font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="title">
      <h1 style="margin:0; font-size:18px">Financial planner</h1>
      <span class="badge">Local-first • Offline-capable</span>
    </div>
  </header>

  <main>
    <section class="panel">
      <header style="display:flex; justify-content:space-between; align-items:center">
        <h2>Bills</h2>
        <span class="chip">Add biller, amount, due date</span>
      </header>
      <div class="content">
        <div class="toolbar">
          <button id="addBillBtn">Add biller</button>
          <button class="secondary" id="sortBillsBtn">Sort by due date</button>
          <button class="secondary" id="hidePaidBtn">Hide paid</button>
        </div>
        <table id="billsTable" aria-label="Bills">
          <thead>
            <tr>
              <th>Biller</th>
              <th>Amount (₱)</th>
              <th>Due date</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="foot">Tip: Use <span class="kbd">Tab</span> to move across cells; <span class="kbd">Ctrl/Cmd + S</span> to save.</div>
    </section>

    <div class="grid" style="margin-top:16px">
      <section class="panel">
        <header style="display:flex; justify-content:space-between; align-items:center">
          <h2>Income</h2>
          <span class="chip">Add salary, gigs, refunds</span>
        </header>
        <div class="content">
          <div class="toolbar">
            <button id="addIncomeBtn">Add income</button>
            <button class="secondary" id="sortIncomeBtn">Sort by date</button>
          </div>
          <table id="incomeTable" aria-label="Income">
            <thead>
              <tr>
                <th>Source</th>
                <th>Amount (₱)</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="foot">Add expected dates to plan payments against incoming cash.</div>
      </section>

      <section class="panel">
        <header>
          <h2>Summary</h2>
        </header>
        <div class="content">
          <div class="summary">
            <div class="card">
              <div class="label">Total bills</div>
              <div class="value" id="totalBills">₱0.00</div>
              <div class="label" id="dueSoonNote"></div>
            </div>
            <div class="card">
              <div class="label">Total income</div>
              <div class="value" id="totalIncome">₱0.00</div>
              <div class="label" id="nextIncomeNote"></div>
            </div>
            <div class="card">
              <div class="label">Remaining balance</div>
              <div class="value" id="remaining">₱0.00</div>
              <div class="label">Income minus all unpaid bills</div>
            </div>
          </div>
          <div class="card" style="margin-top:10px">
            <div class="label" style="margin-bottom:6px">Strategic payment suggestions</div>
            <div id="suggestions"></div>
          </div>
        </div>
        <div class="foot">Suggestions consider due dates vs. available funds at or before each income date.</div>
      </section>
    </div>

    <section class="panel" style="margin-top:16px">
      <header>
        <h2>Data</h2>
      </header>
      <div class="content">
        <div class="toolbar">
          <button class="secondary" id="saveBtn">Save</button>
          <button class="secondary" id="loadBtn">Load</button>
          <button class="danger" id="resetBtn">Reset</button>
        </div>
        <div class="label">Your data is stored only in your browser (localStorage).</div>
      </div>
    </section>
  </main>

  <script>
    const fmtPeso = v => "₱" + (Number(v||0).toFixed(2)).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    const todayISO = () => new Date().toISOString().slice(0,10);
    const parseISO = d => { const t = new Date(d); return isNaN(t) ? null : t; };
    const escapeHTML = s => String(s||"").replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));

    const storeKey = "fp-v1";
    let state = {
      bills: [
        { id: crypto.randomUUID(), name:"VECO", amount:1506.08, due:"2026-01-02", paid:false },
        { id: crypto.randomUUID(), name:"PLDT LLC", amount:1399, due:"2026-01-02", paid:false },
        { id: crypto.randomUUID(), name:"Jessica", amount:2334, due:"2026-01-15", paid:false },
        { id: crypto.randomUUID(), name:"MECO", amount:2000, due:"2026-01-15", paid:false },
        { id: crypto.randomUUID(), name:"Unionbank CC", amount:5142, due:"2026-01-29", paid:false },
        { id: crypto.randomUUID(), name:"Jessica", amount:2334, due:"2026-01-30", paid:false },
        { id: crypto.randomUUID(), name:"Motor", amount:1500, due:"2026-01-30", paid:false },
        { id: crypto.randomUUID(), name:"Maribank", amount:3462.22, due:"2026-02-04", paid:false },
        { id: crypto.randomUUID(), name:"Spaylater", amount:9525.63, due:"2026-02-05", paid:false },
      ],
      income: [
        { id: crypto.randomUUID(), source:"Salary", amount:10000, date:"2026-01-15" },
        { id: crypto.randomUUID(), source:"Photography gig", amount:13000, date:"2026-01-29" },
        { id: crypto.randomUUID(), source:"Salary", amount:10000, date:"2026-01-30" },
      ],
      hidePaid:false
    };

    // Persistence
    function save(){ localStorage.setItem(storeKey, JSON.stringify(state)); flash("Saved"); }
    function load(){
      const s = localStorage.getItem(storeKey);
      if(s){ try{ state = JSON.parse(s); }catch(e){} }
      render(); flash("Loaded");
    }
    function reset(){ localStorage.removeItem(storeKey); state = { bills:[], income:[], hidePaid:false }; render(); flash("Reset"); }

    // UI
    function statusFor(b){
      if(b.paid) return {cls:"status-ok", txt:"Paid"};
      const d = parseISO(b.due); if(!d) return {cls:"status-due", txt:"No date"};
      const days = Math.floor((d - new Date())/(1000*60*60*24));
      if(days < 0) return {cls:"status-overdue", txt:`Overdue ${Math.abs(days)}d`};
      if(days <= 5) return {cls:"status-due", txt:`Due in ${days}d`};
      return {cls:"status-ok", txt:`Due in ${days}d`};
    }

    function bindBillRow(tr, b){
      const nameEl = tr.querySelector('input[data-role="name"]');
      const amtEl  = tr.querySelector('input[data-role="amount"]');
      const dueEl  = tr.querySelector('input[data-role="due"]');
      const paidEl = tr.querySelector('input[data-role="paid"]');
      const dupBtn = tr.querySelector('button[data-action="dup"]');
      const rmBtn  = tr.querySelector('button[data-action="rm"]');

      nameEl.addEventListener("input", ()=>{ b.name = nameEl.value; update(); });
      amtEl.addEventListener("input",  ()=>{ b.amount = parseFloat(amtEl.value)||0; update(); });
      dueEl.addEventListener("change", ()=>{ b.due = dueEl.value; update(); });
      paidEl.addEventListener("change", ()=>{ b.paid = paidEl.checked; update(); });

      dupBtn.addEventListener("click", ()=>{ state.bills.push({...b, id:crypto.randomUUID()}); render(); });
      rmBtn.addEventListener("click", ()=>{ state.bills = state.bills.filter(x=>x.id!==b.id); render(); });
    }

    function bindIncomeRow(tr, i){
      const srcEl  = tr.querySelector('input[data-role="src"]');
      const amtEl  = tr.querySelector('input[data-role="amount"]');
      const dateEl = tr.querySelector('input[data-role="date"]');
      const dupBtn = tr.querySelector('button[data-action="dup"]');
      const rmBtn  = tr.querySelector('button[data-action="rm"]');

      srcEl.addEventListener("input", ()=>{ i.source = srcEl.value; update(); });
      amtEl.addEventListener("input",  ()=>{ i.amount = parseFloat(amtEl.value)||0; update(); });
      dateEl.addEventListener("change", ()=>{ i.date = dateEl.value; update(); });

      dupBtn.addEventListener("click", ()=>{ state.income.push({...i, id:crypto.randomUUID()}); render(); });
      rmBtn.addEventListener("click", ()=>{ state.income = state.income.filter(x=>x.id!==i.id); render(); });
    }

    function render(){
      const billsBody = document.querySelector("#billsTable tbody");
      const incomeBody = document.querySelector("#incomeTable tbody");
      billsBody.innerHTML = ""; incomeBody.innerHTML = "";

      state.bills.forEach(b=>{
        if(state.hidePaid && b.paid) return;
        const s = statusFor(b);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input data-role="name" value="${escapeHTML(b.name)}" aria-label="Biller"></td>
          <td><input data-role="amount" type="number" step="0.01" value="${b.amount}" aria-label="Amount"></td>
          <td><input data-role="due" type="date" value="${b.due||""}" aria-label="Due date"></td>
          <td>
            <label style="display:flex; gap:8px; align-items:center">
              <input data-role="paid" type="checkbox" ${b.paid?"checked":""} aria-label="Mark paid">
              <span class="${s.cls}">${s.txt}</span>
            </label>
          </td>
          <td class="row-actions">
            <button class="secondary" data-action="dup">Duplicate</button>
            <button class="danger" data-action="rm">Remove</button>
          </td>
        `;
        bindBillRow(tr, b);
        billsBody.appendChild(tr);
      });

      state.income.forEach(i=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input data-role="src" value="${escapeHTML(i.source)}" aria-label="Income source"></td>
          <td><input data-role="amount" type="number" step="0.01" value="${i.amount}" aria-label="Amount"></td>
          <td><input data-role="date" type="date" value="${i.date||""}" aria-label="Date"></td>
          <td class="row-actions">
            <button class="secondary" data-action="dup">Duplicate</button>
            <button class="danger" data-action="rm">Remove</button>
          </td>
        `;
        bindIncomeRow(tr, i);
        incomeBody.appendChild(tr);
      });

      update();
    }

    function update(){
      // Totals
      const totalBills = state.bills.filter(b=>!b.paid).reduce((s,b)=>s+(Number(b.amount)||0),0);
      const totalIncome = state.income.reduce((s,i)=>s+(Number(i.amount)||0),0);
      document.getElementById("totalBills").textContent  = fmtPeso(totalBills);
      document.getElementById("totalIncome").textContent = fmtPeso(totalIncome);
      const remaining = totalIncome - totalBills;
      const remEl = document.getElementById("remaining");
      remEl.textContent = fmtPeso(remaining);
      remEl.className = "value " + (remaining>=0 ? "positive":"negative");

      // Due soon (7 days)
      const now = new Date();
      const soon = state.bills.filter(b=>{
        if(b.paid) return false;
        const d = parseISO(b.due); if(!d) return false;
        const days = Math.floor((d - now)/(1000*60*60*24));
        return days >= 0 && days <= 7;
      }).length;
      document.getElementById("dueSoonNote").textContent = soon ? `${soon} due in next 7 days` : "No bills in next 7 days";

      // Next income note
      const nextIncome = state.income
        .map(i=>({i, d:parseISO(i.date)}))
        .filter(x=>x.d && x.d >= now)
        .sort((a,b)=>a.d-b.d)[0];
      document.getElementById("nextIncomeNote").textContent = nextIncome ? `Next: ${nextIncome.i.source} on ${nextIncome.i.date}` : "No upcoming income";

      // Suggestions
      updateSuggestions();
      // Autosave
      localStorage.setItem(storeKey, JSON.stringify(state));
    }

    function updateSuggestions(){
      const box = document.getElementById("suggestions");
      box.innerHTML = "";
      const now = new Date();

      const incomes = [...state.income]
        .map(i=>({ ...i, d:parseISO(i.date)}))
        .filter(i=>i.d)
        .sort((a,b)=>a.d-b.d);

      const bills = [...state.bills]
        .filter(b=>!b.paid)
        .map(b=>({ ...b, d:parseISO(b.due)}))
        .sort((a,b)=>{
          if(!a.d && !b.d) return 0; if(!a.d) return 1; if(!b.d) return -1; return a.d - b.d;
        });

      let available = 0;
      let last = now;

      function line(t){ const p = document.createElement("p"); p.style.margin="6px 0"; p.textContent = t; box.appendChild(p); }

      if(!incomes.length && bills.length){
        line("No upcoming dated income. Add dates to generate a schedule.");
      }

      incomes.forEach((inc)=>{
        if(inc.d < last) return;
        available += Number(inc.amount)||0;
        line(`On ${inc.date}: receive ${fmtPeso(inc.amount)}. Available: ${fmtPeso(available)}.`);

        bills.filter(b => (b.d && b.d <= inc.d) || !b.d).forEach(b=>{
          if(b.__done) return;
          const amt = Number(b.amount)||0;
          if(available >= amt){
            available -= amt; b.__done = true;
            line(`• Pay ${b.name} (${fmtPeso(amt)}) by ${b.d ? b.d.toISOString().slice(0,10) : "—"}. Remaining: ${fmtPeso(available)}.`);
          } else {
            line(`• Not enough for ${b.name} (${fmtPeso(amt)}). Consider partial payment or renegotiation.`);
          }
        });
        last = inc.d;
      });

      const rest = bills.filter(b=>!b.__done);
      if(rest.length){
        line(`After last income: Available ${fmtPeso(available)}.`);
        rest.forEach(b=>{
          const amt = Number(b.amount)||0;
          if(available >= amt){
            available -= amt; b.__done = true;
            line(`• Pay ${b.name} (${fmtPeso(amt)}) by ${b.d ? b.d.toISOString().slice(0,10) : "—"}. Remaining: ${fmtPeso(available)}.`);
          } else {
            line(`• Short for ${b.name} (${fmtPeso(amt)}). Remaining: ${fmtPeso(available)}. Plan for next income.`);
          }
        });
      }

      if(!box.innerHTML){ line("No suggestions. Add bills and income to generate a plan."); }
    }

    // Controls
    document.getElementById("addBillBtn").addEventListener("click", ()=>{
      state.bills.push({ id:crypto.randomUUID(), name:"", amount:0, due:todayISO(), paid:false });
      render();
    });
    document.getElementById("sortBillsBtn").addEventListener("click", ()=>{
      state.bills.sort((a,b)=>{
        const ad = parseISO(a.due), bd = parseISO(b.due);
        if(!ad && !bd) return 0; if(!ad) return 1; if(!bd) return -1; return ad - bd;
      });
      render();
    });
    document.getElementById("hidePaidBtn").addEventListener("click", ()=>{
      state.hidePaid = !state.hidePaid; render();
    });

    document.getElementById("addIncomeBtn").addEventListener("click", ()=>{
      state.income.push({ id:crypto.randomUUID(), source:"", amount:0, date:todayISO() });
      render();
    });
    document.getElementById("sortIncomeBtn").addEventListener("click", ()=>{
      state.income.sort((a,b)=>{
        const ad = parseISO(a.date), bd = parseISO(b.date);
        if(!ad && !bd) return 0; if(!ad) return 1; if(!bd) return -1; return ad - bd;
      });
      render();
    });

    document.getElementById("saveBtn").addEventListener("click", save);
    document.getElementById("loadBtn").addEventListener("click", load);
    document.getElementById("resetBtn").addEventListener("click", reset);

    // Keyboard: Ctrl/Cmd + S to save
    window.addEventListener("keydown",(e)=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==="s"){
        e.preventDefault(); save();
      }
    });

    // Initial
    (function init(){
      const s = localStorage.getItem(storeKey);
      if(s){ try{ state = JSON.parse(s); }catch(e){} }
      render();
    })();
    // Build rows after render()
    function buildRows(){ /* handled by render() */ }
  </script>
</body>
</html>
